---
title: "Mini-Project-2"
author: "Emily and Stephanie"
date: "3/7/2018"
output: 
  html_document:
    code_folding: hide
---

This chunck loads the tidyverse:

```{r message=FALSE}
library(tidyverse)
```

[LINK TO MINI-PROJECT 2 DESCRIPTION](https://beanumber.github.io/sds192/mod_data.html)

This chunck loads all the files available for the project through:
```{r}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```


We designed a function to see which top 5 commitees contributed to a specific canditate and how much the committee contributed.  The graphic also displays the party the committee is affiliated with.  This is the path we took to develop the function.  First we chose which columns we wanted to work with from the candidates dataset.   Then we filtered out for Nancy Pleosi.   


```{r}
NancyPelosi <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation) %>%
  filter(cand_name == 'PELOSI, NANCY')
```

Then we created a new dataset by joining Nancy Pelosi and contributions by using the left_join function.

```{r}
cand_contr <- left_join(NancyPelosi, contributions)
```


We next combined the candiates and contributions dataset we created with committees and selected the folllowing columns: candidate ID, candidate name, candidate party affiliation, name, transcation amount and committee party affiliation.  Then we created a new column that was the sum of all transactions and used the disticng function to remove redundancies in the rows.  We then arranges them in descending order by sum and took the top 5 observations.  This was done in order to obtain a table that had the highest contributing committees for Nancy Pelosi.


```{r}
cand_contr_comm <- left_join(cand_contr, committees) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, transaction_amt, cmte_party_affiliation) %>%
  group_by(name) %>%
  mutate(sum = sum(transaction_amt)) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation, sum) %>%
  distinct(sum,cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation) %>%
  arrange(desc(sum)) %>%
  head(5)
```

```{r}
ggplot(cand_contr_comm, aes(x=name, y=sum, fill="cmte_party_affiliation"))+
  geom_histogram(stat="identity") + 
  labs(y="Dollars Contributed", title="Committee Contribution to Nancy Pelosi")
```


We used ggplot to create a bargraph of the top 5 committees that contributed funds to Nancy Pelosi.  The bars idealy would be color coded by party affiliation, howver the top 5 commitees were commitees that fundraised exlussively for Nnacy Pelosi.  Overall, this was not very interesting so we created a function in order to look at other candiates quickly without repeating all the code.




In the next code chunk we made a large table that joined the data by candidates.

```{r}
cand_contr_start <- candidates %>%
  select(cand_id,cand_name, cand_party_affiliation)
```


```{r}
cand_contrULTRA <- left_join(cand_contr_start, contributions) 
```

Then, we  created a master list with all candidates, candidate ID, candidates party affiliation, the name of each donation, donation amount, and the type of organization each donation is from. 

```{r}
cand_cantrULTRA2 <- left_join(cand_contrULTRA, committees) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, transaction_amt, entity_type, cmte_party_affiliation) %>%
  group_by(name) %>%
  mutate(sum = sum(transaction_amt)) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation, sum) %>%
  distinct(sum,cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation) 
```



The function below makes the desired graph for any candidate.  By choosing any candiate and running it throught the function "top_5", a graphic is produced that shows the top 5 contributing committees. 

```{r}
top_5 <- function(name_arg) {
  plot_data <- cand_cantrULTRA2 %>%
    filter(cand_name == name_arg) %>%
    arrange(desc(sum)) %>%
    head(5)
  ggplot(plot_data,  aes(x=name, y=sum, fill="cmte_party_affiliation"))+
    geom_histogram(stat="identity")
}


ROBY <- top_5( "ROBY, MARTHA")
ROBY
```
[^1]

[^1]: [This is the link to the github repository](https://github.com/EmilyGrote/sds192-mp2.git)


