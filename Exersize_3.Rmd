---
title: "Mini-Project-2"
author: "Emily and Stephanie"
date: "3/22/2018"
output:
  html_document:
    code_folding: hide
---

This chunck loads the tidyverse:

```{r message=FALSE, warning=FALSE}
library(tidyverse)
```

[LINK TO MINI-PROJECT 2 DESCRIPTION](https://beanumber.github.io/sds192/mod_data.html)

This chunck loads all the files available for the project through:
```{r message=FALSE, warning=FALSE}
load("house_elections.rda")
load("candidates.rda")
load("committees.rda")
load("contributions.rda")
```

We decided to explore the connection between candidates and committee party affiliation and contribution.  We used the datasets, candidates, committees and contributions to explore this relationship.  Additionally, we used GitHub to work over break.[^1]

We designed a function to see which top 5 committees contributed to a specific candidate and how much the committee contributed.  The graphic also displays the party the committee is affiliated with.  This is the path we took to develop the function.  First we chose which columns we wanted to work with from the candidate’s dataset.  Then we filtered out for Nancy Pleosi.   


```{r message=FALSE, warning=FALSE}
NancyPelosi <- candidates %>%
  select(cand_id, cand_name, cand_party_affiliation) %>%
  filter(cand_name == 'PELOSI, NANCY')
```

Then we created a new dataset by joining Nancy Pelosi and contributions by using the left_join function.

```{r message=FALSE, warning=FALSE}
cand_contr <- left_join(NancyPelosi, contributions)
```


We next combined the candidates and contributions dataset we created with committees and selected the following columns: candidate ID, candidate name, candidate party affiliation, name, transaction amount and committee party affiliation.  Then we created a new column that was the sum of all transactions and used the distinct() function to remove redundancies in the rows.  We then arranged them in descending order by sum and took the top 5 observations. This was done in order to obtain a table that had the highest contributing committees for Nancy Pelosi.

```{r message=FALSE, warning=FALSE}
cand_contr_comm <- left_join(cand_contr, committees) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, transaction_amt, cmte_party_affiliation) %>%
  group_by(name) %>%
  mutate(sum = sum(transaction_amt)) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation, sum) %>%
  distinct(sum,cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation) %>%
  arrange(desc(sum)) %>%
  head(5)
```

```{r message=FALSE, warning=FALSE}
ggplot(cand_contr_comm, aes(x=name, y=sum, fill="cmte_party_affiliation"))+
  geom_histogram(stat="identity") + 
  labs(y="Dollars Contributed", title="Committee Contribution to Nancy Pelosi")
```

We used ggplot to create a bar graph of the top 5 committees that contributed funds to Nancy Pelosi. The bars ideally would be color-coded by party affiliation, however the top 5 committees were committees that fundraised exclusively for Nancy Pelosi.  Overall, this was not very interesting so we created a function in order to look at other candidates quickly without repeating all the code.



In the next code chunk we made a large table that joined the data by candidates.

```{r message=FALSE, warning=FALSE}
cand_contr_start <- candidates %>%
  select(cand_id,cand_name, cand_party_affiliation)
```


```{r message=FALSE, warning=FALSE}
cand_contrULTRA <- left_join(cand_contr_start, contributions) 
```

Then, we created a master list with all candidates, candidate ID, candidates party affiliation, name of each donation, donation amount, and the type of organization each donation is from. This table was then manipulated to contain the amount contributed by each committee.  Row redundancies were eliminated with the distinct () command.  

```{r message=FALSE, warning=FALSE}
cand_cantrULTRA2 <- left_join(cand_contrULTRA, committees) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, transaction_amt, entity_type, cmte_party_affiliation) %>%
  group_by(name) %>%
  mutate(sum = sum(transaction_amt)) %>%
  select(cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation, sum) %>%
  distinct(sum,cand_id, cand_name, cand_party_affiliation, name, cmte_party_affiliation) 
```


The function below makes the desired graph for any candidate.  Choosing any candidate and running it through the function “top_5” produces a graphic that shows the top 5 contributing committees.

```{r message=FALSE, warning=FALSE}
top_5 <- function(name_arg) {
  plot_data <- cand_cantrULTRA2 %>%
    filter(cand_name == name_arg) %>%
    arrange(desc(sum)) %>%
    head(5)
  ggplot(plot_data,  aes(x=name, y=sum, fill="cmte_party_affiliation"))+
    geom_histogram(stat="identity")
}
```


In the next chunck we selected Martha Roby, a random republican contained within the data set, and ran the name though the function "top_5"
```{r message=FALSE, warning=FALSE}
ROBY <- top_5( "ROBY, MARTHA")
ROBY
```


We noticed after running the function a few times that a lot of committees are not affiliated with a party.  This results in all of the bars being coded the same color, for NA. It appears that we do not have a lot of information about committee affiliation, indicating that these grouped are alighted with a candidate over a political party.





[^1]: [This is the link to the github repository](https://github.com/EmilyGrote/sds192-mp2.git)


